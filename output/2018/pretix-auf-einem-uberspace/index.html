<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>pretix auf einem Uberspace</title>
  <link media="all" href="/style.css" rel="stylesheet" />
  <link media="all" href="/fonts.css" rel="stylesheet" />
  <link href="/favicon.ico" rel="shortcut icon" />
    <link href="/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">
  <link href="/" rel="home start" />
  <link href="/atom/" type="application/atom+xml" rel="alternate" title="Atom Feed" />
  <link href="/rss/" type="application/rss+xml" rel="alternate" title="RSS Feed" />
  <script data-isso="/fcgi-bin/isso" src="/fcgi-bin/isso/js/embed.min.js"></script>
  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
    <meta name="description" content="Im Oktober 2015 schrieb ich eine [Anleitung](/2015..." />
    <meta name="keywords" content="#bcrn16, #pretix" />
</head>
<body>
  <header>
    <h1><a href="/" rel="home start" class="blogtitle">bullshit</a></h1>
    <nav>
      <ul>
        <li><a href="/" rel="home start">blog</a></li>
        <li><a href="/atom/" rel="alternate">atom</a></li>
        <li><a href="/rss/" rel="alternate">rss</a></li>
        <li><a href="/articles/" rel="contents">artikelübersicht</a></li>
        <li><a href="/about/" rel="author">über mich</a></li>
      </ul>
    </nav>
  </header>
    
        <article>
  <header>
    <time datetime="2018-03-23">23.03.2018</time>
    <h1>
      <a href="/2018/pretix-auf-einem-uberspace/" rel="bookmark canonical">pretix auf einem Uberspace</a>
    </h1>
  </header>
  <p>Im Oktober 2015 schrieb ich eine <a href="/2015/pretix-auf-einem-uberspace-installieren/">Anleitung</a>, wie man <a href="https://github.com/pretix/pretix">pretix</a> auf einem <a href="https://uberspace.de">Uberspace</a> in&shy;stal&shy;liert. Nun ist heute nicht mehr Oktober 2015 und die alte Anleitung ent&shy;spre&shy;chend nicht mehr aktuell. Mich haben mehrere Leute darauf hin&shy;ge&shy;wie&shy;sen. Ausserdem brauche ich aus <a href="/2018/osstatus-com/">Gründen</a> selbst ab und an mal eine pretix-Instanz und habe mich ent&shy;schlos&shy;sen, die Anleitung mal zu über&shy;ar&shy;bei&shy;ten und in diesem Blogpost auf einen neueren Stand zu bringen.</p>
<h3>Einleitung</h3>
<p>pretix ist ein Stück freie Software, mit dem man Tickets für Konzerte, Messen, Barcamps und sonstige Ver&shy;an&shy;stal&shy;tun&shy;gen verkaufen kann. Das Tool setzt auf <a href="https://www.djangoproject.com">Django</a> und benötigt Python 3. </p>
<p>Es lässt sich unter <a href="https://docs.pretix.eu/en/latest/admin/installation/manual_smallscale.html">Linux</a> in&shy;stal&shy;lie&shy;ren, die Anleitung dafür kann man aber nicht eins zu eins auf die Ubernauten übertragen. Im Folgenden möchte ich be&shy;schrei&shy;ben, was ich tun musste, um pretix auf einem Uberspace zumindest zum Laufen zu bringen. Der Be&shy;nut&shy;zer&shy;na&shy;me für den Uberspace ist <code>barcamp</code>, der Uberspace selbst heisst <code>kaul</code>. Ich möchte noch darauf hinweisen, dass diese In&shy;stal&shy;la&shy;ti&shy;on eine SQLite-Datenbank nutzt. Die Do&shy;ku&shy;men&shy;ta&shy;ti&shy;on sagt dazu:</p>
<blockquote>
<p>If you have real users on your system you’ll really want to use</p>
<p>A database (MySQL or PostgreSQL)</p>
<p>A reverse proxy web server (nginx or Apache)</p>
</blockquote>
<p>Die Datenbank ist dieser Anleitung egal. Ausserdem fehlen noch ein, zwei andere Klei&shy;nig&shy;kei&shy;ten (siehe unten), um so Sachen wie SSL musst du dich ebenfalls selbst kümmern. Im Großen und Ganzen habe ich mich an die Anleitung der Ubernauten für <a href="https://wiki.uberspace.de/cool:django">Django</a> gehalten und sie mit besagter In&shy;stal&shy;la&shy;ti&shy;ons&shy;an&shy;lei&shy;tung für Linux gekreuzt. </p>
<p>Trotzdem gilt: Du wirst diese Anleitung nicht in dieser Form übernehmen können. <strong>Lies sie aufmerksam und benutze deinen eigenen Kopf, um An&shy;pas&shy;sun&shy;gen zu machen</strong> Wenn du irgendwo nicht wei&shy;ter&shy;kommst oder eine Anregung hast, dann freue ich mich natürlich über <a href="/about/">Fragen und Feedback</a>.</p>
<p>Wenn du — warum auch immer — keine eigene pretix-Instanz betreiben möchtest, kannst du ja mal darüber nachdenken, die gehostete Version zu nutzen. Raphael bietet die Software auch as a Service an — zu <a href="https://pretix.eu/about/de/pricing">sehr er&shy;schwing&shy;li&shy;chen Kon&shy;di&shy;tio&shy;nen</a>.</p>
<h3>Anleitung</h3>
<h4>pretix-In&shy;stal&shy;la&shy;ti&shy;on an sich</h4>
<p>In einem erste Schritt lege ich einen Ordner für die ei&shy;gent&shy;li&shy;che pretix-In&shy;stal&shy;la&shy;ti&shy;on, die Virtual En&shy;vi&shy;ron&shy;ment und das Ver&shy;zeich&shy;nis für die pretix-Daten an:</p>
<pre class="highlight"><code>[barcamp@kaus ~]$ mkdir pretix_installation
[barcamp@kaus ~]$ cd pretix_installation</code></pre>


<p>An&shy;schlie&shy;ßend richte ich die <a href="https://virtualenv.pypa.io/en/stable/">virtuelle Umgebung</a> mit Python 3.6 ein und aktiviere sie:</p>
<pre class="highlight"><code>[barcamp@kaus pretix_installation]$ python3.6 -m venv env
[barcamp@kaus pretix_installation]$ source env/bin/activate</code></pre>


<p>Zwar gibt es pretix auch im <a href="https://de.wikipedia.org/wiki/Pip_(Python)">Python Package Index</a>, aber weil ich ein paar Uberspace-spe&shy;zi&shy;fi&shy;sche An&shy;pas&shy;sun&shy;gen in der <code>settings.py</code> vornehmen muss, bringt das — zumindest nach meinem Kennt&shy;nis&shy;stand, vielleicht weißt du es besser, dann lass mich bitte an deinem Wissen teilhaben — wenig. Zeit, das ent&shy;spre&shy;chen&shy;de Repository auf Github zu klonen und in den Ordner zu wechseln:</p>
<pre class="highlight"><code>(env) [barcamp@kaus pretix_installation]$ git clone https://github.com/pretix/pretix.git
(env) [barcamp@kaus pretix_installation]$ cd pretix</code></pre>


<p>Wenn du ein spezielles Release möchtest, wäre jetzt der richtige Zeitpunkt, den ent&shy;spre&shy;chen&shy;den Branch oder Tag aus&shy;zuch&shy;ecken. Ich gehe davon aus, dass das Repository in einem Ordner namens <code>~/pretix_installation/pretix</code> liegt. Nun geht es daran, die Ab&shy;hän&shy;gig&shy;kei&shy;ten von pretix zu in&shy;stal&shy;lie&shy;ren:</p>
<pre class="highlight"><code>(env) [barcamp@kaus pretix]$ pip install -U gunicorn
(env) [barcamp@kaus pretix]$ pip install -U -r src/requirements.txt</code></pre>


<p>Danach muss ich — wie bereits erwähnt — die <code>settings.py</code> erweitern, wie bei den Ubernauten be&shy;schrie&shy;ben:</p>
<pre class="highlight"><code>(env) [barcamp@kaus pretix]$ cat &lt;&lt; __EOF__ &gt;&gt; src/pretix/settings.py

USE_X_FORWARDED_HOST = True

__EOF__</code></pre>


<p>Wie ebenfalls oben bereits erwähnt, braucht pretix ein Ordner, in dem es alle möglichen Daten ablegen kann. In diesem Beispiel ist es unter anderem die SQLite-Datenbank.</p>
<pre class="highlight"><code>(env) [barcamp@kaus pretix]$ mkdir ../data_dir</code></pre>


<p>pretix schaut an einigen Stellen nach der benötigten <a href="https://docs.pretix.eu/en/latest/admin/config.html">Kon&shy;fi&shy;gu&shy;ra&shy;ti&shy;ons&shy;da&shy;tei</a>, unter anderem im Home-Ver&shy;zeich&shy;nis. Aus Be&shy;quem&shy;lich&shy;keits&shy;grün&shy;den lege ich sie deshalb einfach mal da an:</p>
<pre class="highlight"><code>(env) [barcamp@kaus pretix]$ cat &lt;&lt; __EOF__ &gt; ~/.pretix.cfg

[pretix]
instance_name=Frische Tickets!
url=https://pretix.barcamp.kaus.uberspace.de
currency=EUR
datadir=/home/barcamp/pretix_installation/data_dir

[database]
; Replace mysql with postgresql_psycopg2 for PostgreSQL
backend=sqlite3

__EOF__</code></pre>


<p>Wahr&shy;schein&shy;lich — hof&shy;fent&shy;lich — wird deine anders aussehen. In der Kon&shy;fi&shy;gu&shy;ra&shy;ti&shy;ons&shy;da&shy;tei stehen alle möglichen In&shy;for&shy;ma&shy;tio&shy;nen, abhängig davon, was du alles nutzen möchtest. Bei&shy;spiels&shy;wei&shy;se steht hier die URL, unter der pretix erreichbar ist oder auch, wo sich das Ver&shy;zeich&shy;nis für die Daten befindet.</p>
<p>Hier sei nochmal ein Blick in die ent&shy;spre&shy;chen&shy;de <a href="https://docs.pretix.eu/en/latest/admin/config.html">Do&shy;ku&shy;men&shy;ta&shy;ti&shy;on</a> von pretix empfohlen — sie ist sehr gut. Danach in&shy;itia&shy;li&shy;sie&shy;re ich die Datenbank und lasse die statischen Dateien erstellen. Das hat mir bei etwas gedauert:</p>
<pre class="highlight"><code>(env) [barcamp@kaus pretix]$ python src/manage.py migrate
(env) [barcamp@kaus pretix]$ python src/manage.py rebuild
(env) [barcamp@kaus pretix]$ deactivate</code></pre>


<p>Damit bin ich mit der In&shy;stal&shy;la&shy;ti&shy;on von pretix durch.</p>
<h4>Deamon und Er&shy;reich&shy;bar&shy;keit</h4>
<p>Ich könnte pretix jetzt wie jede andere Django-Anwendung starten. Es würde jedoch nicht im Hin&shy;ter&shy;grund laufen und wäre noch nicht aus dem Internet erreichbar. Darum kümmere ich mich jetzt. Zuerst brauche ich dafür einen Port. Die <a href="https://wiki.uberspace.de/cool:django#deamon_einrichten">Ubernauten empfehlen folgenden Weg</a>, den ich einfach mal gut&shy;ten&shy;ber&shy;ge:</p>
<pre class="highlight"><code>[barcamp@kaus ~]$ DJANGOPORT=$(( $RANDOM % 4535 + 61000)); netstat -tulpen | grep $DJANGOPORT &amp;&amp; echo &quot;versuch's nochmal&quot;</code></pre>


<blockquote>
<p>wenn hier keine Ausgabe <code>versuch's nochmal</code> erscheint, passt alles. Wenn <code>versuch's nochmal</code> kommt - versuchs noch mal :)</p>
</blockquote>
<p>Danach richte ich den ei&shy;gent&shy;li&shy;chen Service ein, der sich darum kümmert, dass pretix im Hin&shy;ter&shy;grund läuft:</p>
<pre class="highlight"><code>[barcamp@kaus ~]$ test -d ~/service || uberspace-setup-svscan 
[barcamp@kaus ~]$ uberspace-setup-service pretix /home/barcamp/pretix_installation/env/bin/gunicorn --error-logfile ~/error-log --reload --chdir /home/barcamp/pretix_installation/pretix/src --bind 127.0.0.1:$DJANGOPORT --workers 4 pretix.wsgi --name pretix --max-requests 1200 --max-requests-jitter 50</code></pre>


<p>Im letzten Schritt muss ich dafür sorgen, dass dieser Service aus dem Internet an&shy;sprech&shy;bar ist:</p>
<pre class="highlight"><code>[barcamp@kaus ~]$ mkdir /var/www/virtual/barcamp/barcamp.kaus.uberspace.de
[barcamp@kaus ~]$ cat &lt;&lt; __EOF__ &gt; /var/www/virtual/barcamp/pretix.barcamp.kaus.uberspace.de/.htaccess
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteBase /
RewriteRule ^(.*)$ http://127.0.0.1:$DJANGOPORT/$1 [P]

RequestHeader set X-Forwarded-Proto https env=HTTPS
__EOF__</code></pre>


<p>Das war's.</p>
<h4>Läuft bei mir</h4>
<p>pretix wäre bei mir jetzt unter <a href="https://pretix.barcamp.kaus.uberspace.de">https://pretix.barcamp.kaus.uberspace.de</a> erreichbar.</p>
<p><img alt="Startbildschirm von pretix" src="/img/IMG_132_pretix.png"/></p>
<p>Da sieht man denn natürlich nicht viel, weswegen ich mich unter <code>http://pretix.barcamp.kaus.uberspace.de/control/login?next=/control/</code> anmelden kann. Als Be&shy;nut&shy;zer&shy;na&shy;me habe ich <code>admin@localhost</code>, als Passwort <code>admin</code> verwendet. <strong>Bitte denk daran, die An&shy;mel&shy;de&shy;da&shy;ten zu ändern!</strong></p>
<p><img alt="Anmeldebildschirm von pretix" src="/img/IMG_99.png"/></p>
<h3>Was noch fehlt</h3>
<h4>Domain</h4>
<p>Wie dir vielleicht auf&shy;ge&shy;fal&shy;len ist, läuft pretix unter einer Subdomain — apropos Domain: <a href="https://pretix.barcamp.kaus.uberspace.de">pretix.barcamp.kaus.uberspace.de</a> ist wesentlich weniger lesbar als bei&shy;spiels&shy;wei&shy;se <a href="https://pretix.domain.tld">pretix.domain.tld</a>, du willst vielleicht also eine <a href="https://wiki.uberspace.de/domain">Domain</a> haben.</p>
<p>Ich habe es zwi&shy;schen&shy;drin mal hin&shy;be&shy;kom&shy;men, dass pretix auch in einem Un&shy;ter&shy;ord&shy;ner lief, mir aber nicht auf&shy;ge&shy;schrie&shy;ben, wie es geklappt hat und nun kann ich als Django/Python-Amateur das nicht mehr nach&shy;voll&shy;zie&shy;hen. Falls jemand einen Hinweis hat, bin ich dankbar.</p>
<h4>pretix-worker, Mails, MariaDB, Plugins...</h4>
<p>Was ebenfalls nicht läuft, ist der in der pretix-Do&shy;ku&shy;men&shy;ta&shy;ti&shy;on erwähnte <em>pretix-worker</em>, ebenfalls fehlen sämtliche — &shy;bis&shy;wei&shy;len ob&shy;li&shy;ga&shy;to&shy;ri&shy;sche — Zu&shy;satzssa&shy;chen wie Mail, eine or&shy;dent&shy;li&shy;che Datenbank, <em>redis</em>, HTTPS, Plugins... Kurz: Sieh diese Anleitung bitte als einen ersten Schritt und kümmere dich an&shy;schlies&shy;send selbst darum, dass deine pretix-In&shy;stal&shy;la&shy;ti&shy;on gut und sicher läuft. Danke.</p>
<h3>Links</h3>
<ul>
<li><a href="https://pretix.eu/about/de/">pretix im Netz</a></li>
<li><a href="https://github.com/pretix/pretix">pretix auf Github</a></li>
<li><a href="https://docs.pretix.eu/en/latest/">pretix-Do&shy;ku&shy;men&shy;ta&shy;ti&shy;on</a></li>
</ul>
  <footer>
  
    <p>Schlagworte:
    <a href="/tag/bcrn16/" rel="tag">#bcrn16</a>
        und
      
    <a href="/tag/pretix/" rel="tag">#pretix</a>
    
    </p>
    
  </footer>
</article>
    
    
        <a href="/2018/dein-freund-und-rauswerfer/" class="page floatright">
        Dein Freund und Rauswerfer &raquo;
        </a>
    
    
<footer>
    
    
    <p><a href="/about/">Kontakt</a>  - <a href="/impressum.html">Impressum</a> - <a href="/datenschutz.html">Datenschutz</a></p>
    
    

  </footer>
  <!-- Piwik -->
  <script type="text/javascript">
    var _paq = _paq || [];
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//bullenscheisse.de/piwik/";
      _paq.push(['setTrackerUrl', u+'piwik.php']);
      _paq.push(['setSiteId', 1]);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <noscript><p><img src="//bullenscheisse.de/piwik/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
  <!-- End Piwik Code -->
</body>
</html>